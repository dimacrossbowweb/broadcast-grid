<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vite + TS</title>
	<style>

		html, body {

			margin: 0;
			padding: 0;

			background-color: #222222;

		}

	</style>
  </head>
  <body>
    <!-- <script type="module" src="/src/index.ts"></script> -->

	<script type="module">
		import { BcGrid, BcCell, BcVideo } from './src/index.ts';

		document.addEventListener( 'DOMContentLoaded', () => {

			navigator.mediaDevices.getUserMedia({ video: true, audio: false })
				.then(function(stream) {

					const video = document.getElementById( 'video' );

					video.srcObject.value = stream;

				})
				.catch(function(err) {
					console.log("An error occurred: " + err);
				});

		} );

	</script>

	<div id="app" style="position: relative; height: 100vh">

		<button onclick="playOrStop()" style="position: fixed; left: 10px; top: 10px; z-index: 1000">

			Play

		</button>

		<bc-grid id="grid">
		
			<bc-cell>
			
				<bc-layer style="display: flex; justify-content: center; align-items: center;">

					<bc-avatar

						color="#992255"
						name="Дмитрий Волгапкин"

					></bc-avatar>

				</bc-layer>
			
			</bc-cell>
		
			<bc-cell>
			
				<bc-layer style="display: flex; justify-content: center; align-items: center;">

				</bc-layer>

				<bc-video id="video"></bc-video>
			
			</bc-cell>
		
			<bc-cell>
			
				<bc-layer style="display: flex; justify-content: center; align-items: center;">

					<bc-avatar

						color="#992255"
						name="Дмитрий Волгапкин"

					></bc-avatar>

				</bc-layer>
			
			</bc-cell>
		
		</bc-grid>

	</div>

	<script>

		let gap = 4;

		let play = false;

		let mediaStream = null;

		function playOrStop () {

			play = !play;

			if ( play ) {

				navigator.mediaDevices.getUserMedia({ video: true, audio: false })
					.then(function(stream) {

						mediaStream = stream;

						const video = document.getElementById( 'video' );

						video.srcObject.value = stream;

					})
					.catch(function(err) {
						console.log("An error occurred: " + err);
					});

			} else {

				const video = document.getElementById( 'video' );

				video.srcObject.value = null;

				if (mediaStream) {
					mediaStream.getTracks().forEach((track) => {
					track.stop();

					

					});
					mediaStream = null;
				}

			}

		}

		function addCell () {

			const cell = document.createElement( 'broadcast-cell' );

			const grid = document.getElementById( 'grid' );

			grid.appendChild( cell );

			const frame = document.createElement( 'broadcast-frame' );
			
			cell.appendChild( frame );

			const layer = document.createElement( 'broadcast-layer' );

			const video = document.createElement( 'broadcast-video' );

			video.setAttribute( 'src', '/video.mp4' );
			video.setAttribute( 'autoplay', 'true' );

			layer.appendChild( video );

			// layer.style.display = 'flex';
			// layer.style.justifyContent = 'center';
			// layer.style.alignItems = 'center';

			cell.appendChild( layer );

			// const avatar = document.createElement( 'broadcast-avatar' );

			// avatar.setAttribute( 'name', 'AA AA' );

			// avatar.setAttribute( 'color', '#920043' );

			// layer.appendChild( avatar );

		}

		function changeGap () {

			const cell = document.createElement( 'broadcast-cell' );

			const grid = document.getElementById( 'grid' );

			grid.setAttribute( 'gap', ++gap );

		}

	</script>

  </body>
</html>
